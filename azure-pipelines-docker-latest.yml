trigger:
  branches:
    include:
      - master

strategy:
  matrix:
    'jdk11-latest':
      buildversion: 'latest'
      jdkversion: '11'

variables:
  mvnversion: '3.9.3'

pool:
  vmImage: ubuntu-latest
steps:
  - task: Docker@2
    displayName: Build latest image
    inputs:
      command: build
      containerRegistry: DockerHub
      dockerfile: '$(Build.SourcesDirectory)/docker/jdk$(jdkversion)/Dockerfile'
      buildContext: '$(Build.Repository.LocalPath)'
      repository: 'jibijose/httpbin'
      tags: 'jdk$(jdkversion)-$(buildversion)'
      arguments: '--build-arg MVN_VERSION=$(mvnversion)'
  - task: Bash@3
    displayName: docker build info
    inputs:
      targetType: 'inline'
      script: |
        docker images
  - task: Docker@2
    displayName: 'Login to Docker Hub'
    inputs:
      containerRegistry : 'DockerHub'
      command: 'login'
  - task: Docker@2
    displayName: 'Push to Docker Hub'
    inputs:
      containerRegistry : 'DockerHub'
      command: 'push'
      repository: 'jibijose/httpbin'
      tags: 'jdk$(jdkversion)-$(buildversion)'
  - task: Docker@2
    displayName: 'Logout from Docker Hub'
    inputs:
      command: 'logout'

